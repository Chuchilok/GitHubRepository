<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>A</title>
    <link rel="stylesheet" href="css/chat.css">

</head>
<body class="keBody">
<audio src="" id="voice">

</audio>
<div id="video-box">
    <video controls="controls" autoplay="autoplay">

    </video>
    <span class="close">×</span>
</div>
<div id="larImage-box">
    <img id="larImage" src="">
    <span class="close">×</span>
</div>
<div id="location-box">
    <div style="width:600px;height:400px;border:1px solid gray" id="containers"></div>
    <span class="close">×</span>
</div>

<div id="person-box">
    <ul>
        <li class="headpic"><img src="img/head/2013.jpg"></li>
        <li class="nickname"><span>昵称：</span><p></p></li>
        <li class="sex"><span>性别：</span><p></p></li>
        <li class="address"><span>地址：</span><p></p></li>
        <li class="phone"><span>手机号：</span><p></p></li>
        <li class="townstreet"><span>街道：</span><p></p></li>
    </ul>
    <span class="close">×</span>
</div>
<div class="kePublic">
    <!--效果html开始-->
    <div class="content">
        <div class="chatBox">
            <div id="add-box">
                <input type="text">
                <button>ADD</button>
            </div>
            <div class="chatLeft">
                <div class="chat01">
                    <div class="chat01_title">
                        <ul class="talkTo">
                            <li><a href="javascript:;"></a></li>
                        </ul>
                        <a class="close_btn" href="javascript:;"></a>
                    </div>
                    <div class="chat01_content">

                    </div>
                </div>
                <div class="chat02">
                    <div class="chat02_title">
                        <a class="chat02_title_btn ctb01" href="javascript:;"></a>

                        <div style="float:left;">
                            <label class="chat02_title_btn ctb02" title="选择图片"><input type="file" id="file_Img"/></label>
                            <input type="button" value="发送图片" id="sendImg"/>
                        </div>
                        <div style="float:left;">
                            <label class="chat02_title_btn ctb03" title="选择视频" style="overflow: hidden;"><input type="file" id="file_Video" style="opacity: 0"/></label>
                            <input type="button" value="发送视频" id="sendVideo"/>
                        </div>
                        <div style="float:left;">
                            <label class="chat02_title_btn ctb04" title="选择语音" style="overflow: hidden;"><input type="file" id="file_Voice" style="opacity: 0"/></label>
                            <input type="button" value="发送语音" id="sendVoice"/>
                        </div>

                        <label class="chat02_title_t">
                            <span id="chat_record">聊天记录</span></label>
                        <div class="wl_faces_box">
                            <div class="wl_faces_content">
                                <div class="title">
                                    <ul>
                                        <li class="title_name">常用表情</li>
                                        <li class="wl_faces_close"><span>&nbsp;</span></li>
                                    </ul>
                                </div>
                                <div class="wl_faces_main">
                                    <ul>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_01.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_02.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_03.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_04.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_05.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_06.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_07.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_08.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_09.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_10.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_11.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_12.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_13.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_14.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_15.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_16.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_17.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_18.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_19.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_20.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_21.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_22.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_23.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_24.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_25.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_26.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_27.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_28.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_29.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_30.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_31.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_32.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_33.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_34.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_35.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_36.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_37.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_38.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_39.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_40.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_41.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_42.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_43.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_44.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_45.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_46.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_47.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_48.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_49.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_50.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_51.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_52.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_53.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_54.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_55.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_56.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_57.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_58.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_59.gif"/></a></li>
                                        <li><a href="javascript:;">
                                            <img src="img/emo_60.gif"/></a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="wlf_icon">
                            </div>
                        </div>
                    </div>
                    <div class="chat02_content">
                        <textarea id="textarea"></textarea>
                    </div>
                    <div class="chat02_bar">
                        <ul>
                            <li style="right: 5px; top: 5px;"><a href="javascript:;">
                                <img src="img/send_btn.jpg" id="sendTxt"></a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="chatRight">
                <div class="chat03">
                    <div class="chat03_title">
                        <label class="chat03_title_t">
                            成员列表
                        </label>
                    </div>
                    <div class="chat03_content">
                        <ul>

                        </ul>
                    </div>
                </div>
            </div>
            <div style="clear: both;">
            </div>
        </div>

        <!--消息盒子开始-->
        <!--<div id="new-box">-->
        <!--<img src="img/bubble.png">-->
        <!--<ul>-->
        <!--<li>-->
        <!--<img src="img/head/2013.jpg">-->
        <!--<span>小杰1</span>-->
        <!--</li>-->
        <!--<li>-->
        <!--<img src="img/head/2013.jpg">-->
        <!--<span>小杰2</span>-->
        <!--</li>-->
        <!--<li>-->
        <!--<img src="img/head/2013.jpg">-->
        <!--<span>小杰</span>-->
        <!--</li>-->
        <!--</ul>-->
        <!--</div>-->
        <!--消息盒子结束-->

    </div>
    <!--效果html结束-->

</div>

<script src="js/jquery-2.1.3.min.js"></script>
<script src="js/map-detail.js"></script>
<script src="js/jsonUrl.js"></script>
<script src="js/upload.js"></script>
<script type="text/javascript" src="js/chat.js"></script>

<script src="js/mqttws31.js" type="text/javascript"></script>
<script>

    var map = new BMap.Map("containers");
    map.addControl(new BMap.OverviewMapControl());


    var hostname = '192.168.1.200',
        port = 8083,
        clientId = 'PetMan_'+token,
        timeout = 5,
        keepAlive = 50,
        cleanSession = false,
        ssl = false,
        userName = '66666666666',
        password = 'd6687f21776e4a9f881970207b8c1234',
        subscribetopic = token;
        s = "UserId_"+userId,
        willMessage = new Paho.MQTT.Message(s),
        willMessage.destinationName = "mqttWill";
    client = new Paho.MQTT.Client(hostname, port, clientId);
    //建立客户端实例
    var options = {
        invocationContext: {
            host: hostname,
            port: port,
            path: client.path,
            clientId: clientId
        },
        timeout: timeout,
        keepAliveInterval: keepAlive,
        cleanSession: cleanSession,
        useSSL: ssl,
        willMessage: willMessage,
        userName: userName,
        password: password,
        onSuccess: onConnect,
        onFailure: function (e) {
            console.log(e);
        }
    };
    client.connect(options);

    //连接服务器并注册连接成功处理事件
    function onConnect() {
//        client.subscribe(subscribetopic);

        console.log("onConnected");
        client.subscribe(subscribetopic);
        s = "UserId_"+userId;
        message = new Paho.MQTT.Message(s);
        message.destinationName = "mqttOnline";
        client.send(message);
    }

    client.onConnectionLost = onConnectionLost;
    //注册连接断开处理事件
    client.onMessageArrived = onMessageArrived;

    //注册消息接收处理事件
    function onConnectionLost(responseObject) {
        console.log(responseObject);
        if (responseObject.errorCode !== 0) {
            console.log("onConnectionLost:" + responseObject.errorMessage);
            console.log("连接已断开");
        }
    }

    var count = 0;

    function start() {
        window.tester = window.setInterval(function () {
            if (client.isConnected) {
                var s = "{time:" + new Date().Format("yyyy-MM-dd hh:mm:ss") + ", content:" + (count++) + ", from: web console}";
                message = new Paho.MQTT.Message(s);
                message.destinationName = topic;
                client.send(message);
            }
        }, 1000);
    }

    function stop() {
        window.clearInterval(window.tester);
    }

    Date.prototype.Format = function (fmt) { //author: meizz
        var o = {
            "M+": this.getMonth() + 1, //月份
            "d+": this.getDate(), //日
            "h+": this.getHours(), //小时
            "m+": this.getMinutes(), //分
            "s+": this.getSeconds(), //秒
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
            "S": this.getMilliseconds() //毫秒
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    }

</script>
</body>
</html>

